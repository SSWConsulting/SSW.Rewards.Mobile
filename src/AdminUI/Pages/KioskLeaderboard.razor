@layout KioskLayout
@page "/kiosk-leaderboard"

<MudPaper Class="kiosk-leaderboard" Style="padding: 2rem; margin-top: 0.5rem; min-height: 100vh; background: #121212; color: #fafafa;">
    <div style="display: flex; flex-direction: column; align-items: center; margin-bottom: 1.25rem;">
        <MudImage Src="/images/ssw-rewards-logo.svg" Class="mb-2" Style="height: 60px; margin: 0 auto; display: block;" />
        <MudText Typo="Typo.subtitle1" Style="color: #ccc; text-align: center; margin-top: 0.5rem;">
            Use this app to scan SSW QR codes, earn SSW Points ⭐, claim rewards and win prizes!
        </MudText>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; margin-bottom: 1rem;">
        <div style="width: 600px; max-width: 100%;">
            <MudTabs Rounded="true" Centered="true" Class="kiosk-tabs" Style="background: transparent; box-shadow: none; width: 100%;">
                <MudTabPanel Text="Week" OnClick="eventArgs => OnTabChanged(0)" />
                <MudTabPanel Text="Month" OnClick="eventArgs => OnTabChanged(1)" />
                <MudTabPanel Text="Year" OnClick="eventArgs => OnTabChanged(2)" />
                <MudTabPanel Text="All Time" OnClick="eventArgs => OnTabChanged(3)" />
            </MudTabs>
        </div>
    </div>
    <div style="display: flex; justify-content: center;">
        <div style="width: 600px; max-width: 100%;">
            <MudTable @ref="table" TItem="MobileLeaderboardUserDto" ServerData="@ServerReload" FixedHeader="true" Dense="false" Hover="true" Bordered="false" Striped="false" Class="kiosk-leaderboard-table" Style="border-radius: 16px; box-shadow: 0 4px 24px rgba(0,0,0,0.3); overflow: hidden; background: #181818;" RowsPerPage="@_defaultPageSize">
                <HeaderContent>
                    <MudTh Style="width: 80px; text-align: center;">Rank</MudTh>
                    <MudTh Style="width: 320px;">Name</MudTh>
                    <MudTh Style="width: 160px; text-align: center;">Points</MudTh>
                </HeaderContent>
                <RowTemplate Context="row">
                    <MudTd Style="width: 80px; text-align: center;" DataLabel="Rank">@row.Rank</MudTd>
                    <MudTd Style="width: 320px;" DataLabel="Name">
                        <div class="d-flex flex-nowrap gap-2 align-center">
                            <Avatar Url="@row.ProfilePic" />
                            <MudText Typo="Typo.body1">@row.Name</MudText>
                            @if (row.Rank == 1)
                            {
                                <MudText Typo="Typo.body1">👑</MudText>
                            }
                        </div>
                    </MudTd>
                    <MudTd Style="width: 160px; text-align: center;" DataLabel="Points">@row.Points.ToString("N0")</MudTd>
                </RowTemplate>
            </MudTable>
        </div>
    </div>
    @if (!_hasErrorsOnUpdate)
    {
        <div style="text-align: center; margin-top: 2rem; font-size: 1.1rem; color: #ccc;">
            Last refreshed: @GetLastUpdatedText() (refreshing in @_secondsUntilRefresh seconds)
        </div>
    }
    else
    {
        <div style="text-align: center; margin-top: 2rem; font-size: 1.1rem; color: #FF7A7A;">
            ⚠️ We couldn't refresh the leaderboard. Retrying in @_secondsUntilRefresh seconds.<br />
            Last refreshed: @GetLastUpdatedText()
        </div>
    }
</MudPaper>
